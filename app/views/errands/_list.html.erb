<div>
  <%= link_to raw("<i class=\"material-icons\">add</i>"), 
              new_session_errand_path(@app_session), 
              class: "btn-floating btn-large waves-effect waves-circle waves-light green lighten-1 right" %>
  <h3>
    <%= (@label? @label.name : "TODOs") %>
  </h3>
</div>

<br />

<%= render 'errands/searchbar' %>

<br />

<ul class="collapsible flatten borderless" data-collapsible="expandable">
  <li>
    <a class="collapsible-header transparent grey-text text-darken-1 blue-hover active">
      <i class="material-icons">arrow_drop_down</i>
      <h5>Pending TODOs</h5>
    </a>
    
    <br />
    
    <div class="collapsible-body borderless">
      <% if @errands and @errands.empty? %>
        <div class="card-panel green lighten-3 center-align">
          You have no TODO tasks yet.
        </div>
      <% else %>
        <ul class="collapsible popout collection" data-collapsible="accordion">
          <%= render @errands %>
        </ul>
      <% end %>
    </div>

    <br />
    
  </li>

  <li>
    <a class="collapsible-header transparent grey-text text-darken-1 blue-hover">
      <i class="material-icons">arrow_drop_down</i>
      <h5>Completed TODOs</h5>
    </a>
    <br />
    <div class="collapsible-body borderless">
      <% if @errands_done and @errands_done.empty? %>
        <div class="card-panel grey lighten-2 center-align">
          You have no completed TODOs.
        </div>
      <% else %>
        <ul class="collapsible popout collection" data-collapsible="accordion">
          <% @errands_done.each do|errand| %>

            <li class="collection-item avatar grey-back">

              <i class="material-icons circle grey">assignment_turned_in</i>
            
              <div class="collapsible-header">
                <div class="right">
                  <%= link_to raw("<i class=\"small material-icons\">create</i>"),
                      edit_session_errand_path(@app_session, errand),
                      class: "grey-text blue-hover" %>
                  <%= link_to raw("<i class=\"small material-icons\">delete</i>"), 
                      [@app_session, errand, {label: (@label ? @label.id : nil)}], 
                      method: :delete, 
                      data: { confirm: 'Are you sure?' },
                      class: "grey-text red-hover" %>
                  <%= link_to raw("<i class=\"small material-icons\">undo</i>"), 
                      toggle_session_errand_path(@app_session, errand, {label: (@label ? @label.id : nil)}), 
                      method: :patch, 
                      class: "grey-text orange-hover" %>
                </div>      

                <span class="title">
                  <%= errand.title %>
                </span>

                <% if errand.deadline %>
                  <div class="text-darken-2 grey-text">
                    Was due:  <%= errand.deadline.strftime("%-d %B, %Y") %>
                  </div>
                <% end %>
              </div>
            
              <div class="collapsible-body">
                <p class="row">
                  <%= errand.content %>
                </p>
                
                <% if errand.labels and !errand.labels.empty?%>
                  <div class="divider green darken-3"></div>
                  <br />

                  <% errand.labels.each do |label| %>
                    <span class="icon-chip blue-grey lighten-3">
                    <i class="material-icons blue-grey-text text-darken-2">label</i>
                    <%= label.name %>
                    </span>
                  <% end %>
                <% end %>
              </div>
            </li>
          <% end %>
        </ul>
      <% end %>
    </div>
  </li>
</ul>